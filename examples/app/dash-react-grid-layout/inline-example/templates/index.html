{% extends base %}
{% block preamble %}

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <!-- react-grid-layout css-->
  <link rel="stylesheet" href="inline-example/static/css/react-grid-layout.css">
  <!-- react-resizable css-->
  <link rel="stylesheet" href="inline-example/static/css/react-resizable.css">
  <!-- React development assets -->
  <link href="inline-example/static/css/custom.min.css" rel="stylesheet">
  <script src="https://unpkg.com/react@16/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/babel-standalone@latest/babel.min.js" crossorigin></script>
  <!-- React-grid-layout script -->
  <script src="inline-example/static/js/react-grid-layout.min.js"></script>
{% endblock %}

{% block contents %}

<div class="container body">
  <div class="main_container">
     <!-- page content -->

    <div id="mydiv"></div>

  </div>
</div>
<!-- /page content -->

<!-- Load our React component. -->
<script type="text/babel">

  //react component class
  class MyFirstGrid extends React.Component {
  
    constructor(props) {
      super(props);
      this.chart1 = [];
      this.line = '{{ embed(roots.line) }}';
      this.region = '{{ embed(roots.region) }}';
      this.platform = '{{ embed(roots.platform) }}';
      this.table = '{{ embed(roots.table) }}';

      let stats = {{stats}};
      
      console.log({{stats_names}});
      {{stats_names}}.map((name) =>  {
        let color = "red"
        let dir = "desc"
        let fav = stats[name].icon
        console.log(stats[name]);
        if(stats[name].change > 0){
          color = "green"
          dir = "asc"
        }
        this.chart1.push(
          <div key={name} className="col-md-2 col-sm-4 col-xs-6 tile_stats_count">
            <span className="count_top"><i className={"fa fa-" + fav}></i> {stats[name].label}</span>
            <div className="count">{stats[name].value}</div>
            <span className="count_bottom"><i className={color}><i className={"fa fa-sort-" + dir}></i>{stats[name].change} </i> From last Week</span>
          </div>
        )
      })
    }
  
  get_data_root_id(tag_str){
      return tag_str.split('data-root-id=')[1].split('"')[1]
  }

  resize_layout(obj, old_, new_, p, e, element) {
    window.Bokeh.index[new_['i']].resize_layout();
  }

  render() {
    // layout is an array of objects, see the demo for more complete usage
    const layout = [
      {i: 'z', x: 2, y: 0, w: 10, h: 5, static:true},
      {i: this.get_data_root_id(this.line), x: 1, y: 6, w: 10, h: 6},
      {i: this.get_data_root_id(this.region), x: 1, y: 16, w: 3, h: 9},
      {i: this.get_data_root_id(this.platform), x: 4, y: 16, w: 3, h: 9},
      {i: this.get_data_root_id(this.table), x: 7, y: 16, w: 4, h: 9},
    ];
    
    console.log(this.parent)
    return <ReactGridLayout
              className="layout"
              layout={layout}
              cols={12}
              rowHeight={30}
              width={window.screen.width}
              onResize={this.resize_layout}
              margin={[10,10]}
              draggableCancel='.bk-root'>

          <div key="z" className="row tile_count list">
            {this.chart1}
          </div>
           
            <div key={this.get_data_root_id(this.line)} className="x_panel tile">
              <h3>Network Activities <small>Traffic per day</small></h3>
              <div className="clearfix"></div>
              {{ embed(roots.line) }}
            </div>

            <div key={this.get_data_root_id(this.region)} className="x_panel tile">
                <h2>By Region</h2>
                <div className="clearfix"></div>
              {{ embed(roots.region) }}
            </div>

            <div key={this.get_data_root_id(this.platform)} className="x_panel tile">
                <h2>By Platform</h2>
                <div className="clearfix"></div>
              {{ embed(roots.platform) }}
            </div>
            <div key={this.get_data_root_id(this.table)} className="x_panel tile">
                <h2>Details</h2>
                <div className="clearfix"></div>
              {{ embed(roots.table) }}
            </div>

      </ReactGridLayout>
  }
}

ReactDOM.render(<MyFirstGrid />, document.getElementById('mydiv'))
</script>

{% endblock %}
